<!doctype html>
<html>
<head>
  <title>Small World Network</title>

  <script type="text/javascript" src="http://visjs.org/dist/vis.js"></script>
  <link href="http://visjs.org/dist/vis.css" rel="stylesheet" type="text/css" />

  <style type="text/css">
    body {
        color: #d3d3d3;
        font: 12pt arial;
        background-color: #222222;
    }

    #network {
        position:fixed;
        padding:0;
        margin:0;

        top:0;
        left:0;

        width: 100%;
        height: 100%;

        border:0px;
        background-color: #222222;
    }
  </style>
</head>
<body>

<div id="network"></div>

<script type="text/javascript">

  //url decoder from:
  //http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
  var qs = (function(a) {
      if (a == "") return {};
      var b = {};
      for (var i = 0; i < a.length; ++i)
      {
          var p=a[i].split('=', 2);
          if (p.length == 1)
              b[p[0]] = "";
          else
              b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
      }
      return b;
  })(window.location.search.substr(1).split('&'));

  function draw(model, id){
    // create a network
    var container = document.getElementById(id);
    var data = {nodes: model.nodes, edges: model.edges};
    var options = {layout:{randomSeed:17}};
    return new vis.Network(container, data, options);
  }
  
  function generateWattsStrogatzModel(N, K, P){
    if(N < 0){throw "Number of nodes N must be greater than 1"}
    if(K < 0 || K % 2 != 0){throw "Node degree K must be a positive even number"}
    if(P < 0 || P > 1){throw "Probability of rewiring must be 0<=P<=1"}

    var nodes = new Array(N);
    var edges = [];

    //position nodes in a circle
    var w = window.innerWidth;
    var h = window.innerHeight;

    var x0 = 0;
    var y0 = 0;
    var r = w < h ? w/3 : h/3;

    for(var n = 0; n < N; n++){
       nodes[n]=({id: n, label: n,
                  x: x0 + r * Math.cos(2*Math.PI*n/N),
                  y: y0 + r * Math.sin(2*Math.PI*n/N),
                  fixed:{x:true,y:true}});
    }

    console.log(nodes);

    for (var n = 0; n < N; n++) {
      for(var k = 0; k <= K/2; k++){
        if(k != 0){
          edges.push({from: n,
                      to: (n+k < 0) ? nodes.length+k : (n+k)%nodes.length});
        }
      }
    }

    //rewire
    for(var e = 0; e < edges.length; e++){
      if(Math.random() < P){ //rewire and avoid self-wiring
        do{}
        while((edges[e].to = Math.floor(Math.random() * N)) == edges[e].from);
      }
    }

    return {"nodes": nodes, "edges": edges};
  }

  var model = generateWattsStrogatzModel(qs["N"] || 30, qs["K"] || 4, qs["P"] || 0.15);

  var network = draw(model,'network');

</script>
</body>
</html>

